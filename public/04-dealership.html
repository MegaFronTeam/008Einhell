<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="utf-8">
		<title>Dealership </title>
		<meta name="description" content="о чем страница">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width,initial-scale=1.0,  shrink-to-fit=no, viewport-fit=cover">
		<link type="image/ico" href="img/favicon.ico" rel="shortcut icon"><meta name="format-detection" content="telephone=no"> 
		<link href="libs/swiper/swiper-bundle.min.css" rel="stylesheet"/>
		<link href="libs/@fancyapps/ui/fancybox/fancybox.css" rel="stylesheet"/>
		<link rel="preload" href="fonts/OpenSansRegular.woff2" as="font" type="font/woff2" crossorigin="crossorigin"/>
		<link rel="preload" href="fonts/OpenSansBold.woff2" as="font" type="font/woff2" crossorigin="crossorigin"/>
		<link rel="preload" href="fonts/OpenSansLight.woff2" as="font" type="font/woff2" crossorigin="crossorigin"/>
		<link rel="preload" href="fonts/OpenSansSemiBold.woff2" as="font" type="font/woff2" crossorigin="crossorigin"/>
		<link rel="preload" href="fonts/OpenSans_CondensedBold.woff2" as="font" type="font/woff2" crossorigin="crossorigin"/>
		<link href="css/custom-bootstrap.min.css" rel="stylesheet"/>
		<link href="css/main.min.css" rel="stylesheet"/>
		<script>
			function addBlock(elem) {
				fetch(`parts/${elem}.html`)
					.then(response => response.text())
					.then( text => {
						const wrap = document.querySelector(`#${elem}Wrap`);
						wrap.insertAdjacentHTML('afterend', text);
						wrap.previousElementSibling.remove()
						wrap.remove();
					});
			}
		</script>
	</head>
	<body class="main-page">
		<div class="main-wrapper">
			<script>addBlock(`header`)</script>
			<div id="headerWrap"></div>
			<main>
				<div class="container">
					<nav class="swiper breadcrumb-slider--js" aria-label="breadcrumb">
						<ol class="breadcrumb swiper-wrapper" itemscope="itemscope" itemtype="http://schema.org/BreadcrumbList">
							<li class="breadcrumb-item swiper-slide" itemprop="itemListElement" itemscope="itemscope" itemtype="http://schema.org/ListItem"><a href="/" itemprop="item"><span itemprop="name">Главная</span>
									<meta itemprop="position" content="1"/></a></li>
							<li class="breadcrumb-item active swiper-slide" itemprop="itemListElement" itemscope="itemscope" itemtype="http://schema.org/ListItem"><a href="#" itemprop="item"><span itemprop="name">Dealership </span>
									<meta itemprop="position" content="2"/></a></li>
						</ol>
					</nav>
				</div>
				<!-- start sDistributor-->
				<div class="sDistributor sDistributor--dealership section" id="sDistributor">
					<div class="sDistributor__top">
						<div class="container">
							<div class="sDistributor__top-container">
								<div class="search-block">
									<form>
										<div class="search-block__title d-none d-lg-block">Найти ближайший сервисный центр
										</div>
										<div class="search-block__input-wrap">
											<input type="text" placeholder="Выберите город.." inputmode="search"/>
											<ul class="search-block__search-result">
											</ul>
										</div>
										<button class="btn btn-primary">
											<svg class="icon icon-search ">
												<use xlink:href="img/svg/sprite.svg#search"></use>
											</svg>
										</button>
									</form>
								</div>
								<div class="sDistributor__view">
									<div class="sDistributor__view-label">Посмотреть:
									</div>
									<a class="sDistributor__view-label active" href="#">
										<svg class="icon icon-pin ">
											<use xlink:href="img/svg/sprite.svg#pin"></use>
										</svg>На карте
									</a>
									<a class="sDistributor__view-label" href="#">
										<svg class="icon icon-list ">
											<use xlink:href="img/svg/sprite.svg#list"></use>
										</svg>Списком
									</a>
								</div>
								<div class="sDistributor__img-wrap"><img src="img/duration.png" alt="" loading="lazy"/>
								</div>
							</div>
						</div>
					</div>
					<div class="sDistributor__map-wrap">
						<div id="map"></div>
						<div class="container">
							<div class="sDistributor__item-list">
								<div class="sDistributor__item" data-coords="[55.662187, 37.630499]">
									<div class="sDistributor__item-top">15.4 км 
									</div>
									<div class="sDistributor__item-text">
										<address>
											<div class="sDistributor__item-city">Москва
											</div>
											<div class="sDistributor__item-address">ООО «Олливер»
											</div>
											<div class="sDistributor__item-address">Каширское шоссе, д. 16
											</div>
										</address>
										<div class="sDistributor__details">
											<svg class="icon icon-metro ">
												<use xlink:href="img/svg/sprite.svg#metro"></use>
											</svg>м. Каширская
										</div>
										<div class="sDistributor__info">
											<div class="sDistributor__info-term">Режим работы
											</div>
											<div class="sDistributor__info-def">10:00 - 19:00
											</div>
										</div>
										<div class="sDistributor__info">
											<div class="sDistributor__info-term">Телефон
												<a class="sDistributor__info-def" href="tel:tel">8 (925) 088-81-018
												</a>
											</div>
										</div>
										<a class="sDistributor__details" href="#">
											<svg class="icon icon-web ">
												<use xlink:href="img/svg/sprite.svg#web"></use>
											</svg>Перейти на сайт
										</a>
										<button class="sDistributor__item-btn btn btn-primary">Построить маршрут
											<svg class="icon icon-route ">
												<use xlink:href="img/svg/sprite.svg#route"></use>
											</svg>
										</button>
									</div>
								</div>
								<div class="sDistributor__item" data-coords="[55.662187, 37.630499]">
									<div class="sDistributor__item-top">15.4 км 
									</div>
									<div class="sDistributor__item-text">
										<address>
											<div class="sDistributor__item-city">Москва
											</div>
											<div class="sDistributor__item-address">ООО «Олливер»
											</div>
											<div class="sDistributor__item-address">Каширское шоссе, д. 16
											</div>
										</address>
										<div class="sDistributor__details">
											<svg class="icon icon-metro ">
												<use xlink:href="img/svg/sprite.svg#metro"></use>
											</svg>м. Каширская
										</div>
										<div class="sDistributor__info">
											<div class="sDistributor__info-term">Режим работы
											</div>
											<div class="sDistributor__info-def">10:00 - 19:00
											</div>
										</div>
										<div class="sDistributor__info">
											<div class="sDistributor__info-term">Телефон
												<a class="sDistributor__info-def" href="tel:tel">8 (925) 088-81-018
												</a>
											</div>
										</div>
										<a class="sDistributor__details" href="#">
											<svg class="icon icon-web ">
												<use xlink:href="img/svg/sprite.svg#web"></use>
											</svg>Перейти на сайт
										</a>
										<button class="sDistributor__item-btn btn btn-primary">Построить маршрут
											<svg class="icon icon-route ">
												<use xlink:href="img/svg/sprite.svg#route"></use>
											</svg>
										</button>
									</div>
								</div>
								<div class="sDistributor__item" data-coords="[55.662187, 37.630499]">
									<div class="sDistributor__item-top">15.4 км 
									</div>
									<div class="sDistributor__item-text">
										<address>
											<div class="sDistributor__item-city">Москва
											</div>
											<div class="sDistributor__item-address">ООО «Олливер»
											</div>
											<div class="sDistributor__item-address">Каширское шоссе, д. 16
											</div>
										</address>
										<div class="sDistributor__details">
											<svg class="icon icon-metro ">
												<use xlink:href="img/svg/sprite.svg#metro"></use>
											</svg>м. Каширская
										</div>
										<div class="sDistributor__info">
											<div class="sDistributor__info-term">Режим работы
											</div>
											<div class="sDistributor__info-def">10:00 - 19:00
											</div>
										</div>
										<div class="sDistributor__info">
											<div class="sDistributor__info-term">Телефон
												<a class="sDistributor__info-def" href="tel:tel">8 (925) 088-81-018
												</a>
											</div>
										</div>
										<a class="sDistributor__details" href="#">
											<svg class="icon icon-web ">
												<use xlink:href="img/svg/sprite.svg#web"></use>
											</svg>Перейти на сайт
										</a>
										<button class="sDistributor__item-btn btn btn-primary">Построить маршрут
											<svg class="icon icon-route ">
												<use xlink:href="img/svg/sprite.svg#route"></use>
											</svg>
										</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- end sDistributor-->
			</main>
			<script>addBlock(`footer`)</script>
			<div id="footerWrap"></div>
		</div>
		<script src="libs/jquery/jquery.min.js"></script>
		<script src="libs/@fancyapps/ui/fancybox/fancybox.umd.js"> </script>
		<script src="libs/swiper/swiper-bundle.min.js"> </script>
		<script src="libs/inputmask/inputmask.min.js"> </script>
		<script src="libs/hc-sticky/hc-sticky.js"> </script>
		<script src="js/JSCCommon.js"></script>
		<script src="js/common.js"></script>
		<script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU&amp;apikey=2066e304-cee0-4ed2-9cb2-5f6521d5f96c"> </script>
		<script>
var myMap, objectManager
function initMap() { 
	var center = [4.75380038320217, 90.62071970898438];
	myMap = new ymaps.Map('map', {
		center: center,
		// center: coords[0],
		zoom: 2,
		clusterize: true,
		gridSize: 34,
		controls: ['zoomControl']
	});

	objectManager = new ymaps.ObjectManager({
		// Чтобы метки начали кластеризоваться, выставляем опцию.
		clusterize: true,
		// ObjectManager принимает те же опции, что и кластеризатор.
		gridSize: 34,
		clusterDisableClickZoom: true
});

				// Чтобы задать опции одиночным объектам и кластерам,
		// обратимся к дочерним коллекциям ObjectManager.
		objectManager.objects.options.set({
			iconLayout: 'default#image',
			iconImageHref: 'img/pin-map.png',
			iconImageSize: [37, 46],
			iconImageOffset: [-24, -38]
		});
		objectManager.clusters.options.set('preset', 'islands#redClusterIcons');

		myMap.geoObjects.add(objectManager)
		
		
		let  points = [];
		let getPixelBounds = [];
		$.ajax({
			url: "data.json"
		}).done(function(data) {
			objectManager.add(data); 
			points.push(data.features)
			getPixelBounds = objectManager.getPixelBounds();

			
			myMap.setBounds(myMap.geoObjects.getBounds(), {
				checkZoomRange: true
		});
		});
	
	let searchList = document.querySelector(".search-block__result"); 
	if (!searchList) return;
	function showBaloon(index, el) {
		
		var objectState = objectManager.getObjectState(el); 
		myMap.setCenter(points[0][index].geometry.coordinates, 8);

		myMap.geoObjects.add(objectManager);
				// if (objectState.isClustered) {
				//     // Сделаем так, чтобы указанный объект был "выбран" в балуне.
				//     objectManager.clusters.state.set('activeObject', objectManager.objects.getById(el));
				//     // Все сгенерированные кластеры имеют уникальные идентификаторы.
				//     // Этот идентификатор нужно передать в менеджер балуна, чтобы указать,
				//     // на каком кластере нужно показать балун.
				//     objectManager.clusters.balloon.open(objectState.cluster.id);
				// } else {
						objectManager.objects.balloon.open(el);
				// }
	}
	searchList.addEventListener("click", function (e) {
		const target = e.target.closest(".search-block__link")
		if (!target) return;
		e.preventDefault();
		showBaloon(target.dataset.index, target.dataset.coords)
		// ymaps.geoQuery(geoObjects).getClosestTo().balloon.open();  
	})

	let input = document.querySelector("#suggest1");
	input.addEventListener('input', function () {
		var filter, ul, li, a, i;
		filter = this.value.toUpperCase(); 
		searchList.innerHTML = '';
		for (i = 0; i < points[0].length; i++) { 
			let title= points[0][i].properties.balloonContentHeader
			let id = points[0][i].id
			if (title.toUpperCase().indexOf(filter) > -1) {
				let text = `
					<li class="sRpnContent__search-item">
						<a href="#" class="sRpnContent__search-link" data-index="${i}" data-coords="${id}">
							${title}
						</a>
					</li>
			`
			searchList.insertAdjacentHTML('beforeend', text);
				// li[i].style.display = "";
			} else {
				// li[i].style.display = "none";
			}
		}
	})


	let button = document.querySelector(".sRpnContent__search button");
	button.addEventListener('click', function () {
		var filter, ul, li, a, i;
		filter = input.value.toUpperCase();
		let searchList = document.getElementById("myDropdown");
		li = searchList.querySelectorAll("li");

		for (i = 0; i < li.length; i++) {
			let txtValue = li[i].querySelector("a").innerText;
			if (txtValue.toUpperCase().indexOf(filter) > -1) {
				showBaloon(li[i].querySelector("a"))
				document.querySelector(".sRpnContent__search-result").classList.remove('active');
			}
		}
	})

}; 

ymaps.ready(initMap);  
		</script>
	</body>
</html>